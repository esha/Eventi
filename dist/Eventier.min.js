/*! Eventier - v0.1.0 - 2013-11-26
* https://github.com/nbubna/Eventier
* Copyright (c) 2013 ESHA Research; Licensed MIT */
!function(global,document,HTML){"use strict";var Eventier=function(a){return a&&"string"==typeof a?_.create.apply(this,arguments):_.copyTo(a)||a},AppEvent=global.CustomEvent||function(a,b){b=b||{};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,!!b.bubbles,!!b.cancelable,b.detail),c},_={global:document||global,slice:function(a,b){return Array.prototype.slice.call(a,b)},resolveRE:/^([\w\$]+)?((\.[\w\$]+)|\[(\d+|'(\\'|[^'])+'|"(\\"|[^"])+")\])*$/,splitRE:/ (?![^\(\)]*\))+/g,noop:function(){},create:function(a,b){var c,d={text:a};if(a=_.parse(a,d),b)for(c in b)b.hasOwnProperty(c)&&(d[c]=b[c]);"bubbles"in d||(d.bubbles=!0);var e=new AppEvent(a,d);for(c in d)e[_.prop(c)]=d[c];return _.propagation(e),e},propagation:function(a){var b=a.stopImmediatePropagation||_.noop;a.stopImmediatePropagation=function(){b.call(this),a.immediatePropagationStopped=!0}},parsers:[[/^_/,function(){this.bubbles=!1}],[/\((.*)\)/,function(a,b){try{this.detail=_.resolve(b)||JSON.parse(b)}catch(c){this.detail=b}}],[/#(\w+)/g,function(a,b){(this.tags||(this.tags=[])).push(b),this[b]=!0}],[/^(\w+):/,function(a,b){this.category=b}]],parse:function(a,b){return _.parsers.forEach(function(c){a=a.replace(c[0],function(){return c[1].apply(b,arguments)||""})}),a},prop:function(a){return a},copyTo:function(a,b,c){if("object"==typeof a){for(b in Eventier)Eventier.hasOwnProperty(b)&&"function"==typeof(c=Eventier[b])&&(a[b]=c);return a}},resolve:function(reference,context){return _.resolveRE.test(reference)?(context=context||global,eval("context"+("["!==reference.charAt(0)?"."+reference:reference))):void 0},fixArgs:function(a,b){return function(c,d){var e,f=_.slice(arguments);if("string"==typeof c&&(d=c,c=this&&this!==Eventier?this:_.global,f.unshift(c)),f.length>a&&(f[a]=f.slice(a),f=f.slice(0,a)),"string"==typeof d&&(f[1]=d.split(_.splitRE)),"length"in c)for(var g=0,h=c.length;h>g;g++)e=b.apply(c,f);else e=b.apply(c,f);return void 0===e?this:e}}};Eventier._=_,_.fire=function(a,b,c,d,e){c?"object"==typeof c&&("bubbles"in c||"detail"in c||"cancelable"in c)||(d=d?d.unshift(c)&&d:[c]):c={},d&&d.length&&(c.data=d);var f;if(1===b.length)f=_.create(b[0],c),_.dispatch(f);else{c.sequence=b;for(var g=e||0;g<b.length&&(!f||!f.isSequenceStopped());g++)b[g]?(c.index=g,f=c.previousEvent=_.create(b[g],c),_.sequence(f,c,a),_.dispatch(f)):b.splice(g--,1)}return f},_.dispatch=function(a,b){return(a.dispatchEvent||a[_.secret]||_.noop)(b)},_.sequence=function(a,b,c,d){a.resumeSequence=function(a){d&&(d=!1,_.fire(c,b.sequence,b,null,a||b.index))},a.stopSequence=function(a){return d!==!1?(d=!0,a&&a.then(this.resumeSequence)):void 0},a.isSequenceStopped=function(){return!!d}},Eventier.fire=_.fixArgs(3,_.fire),_.on=function(a,b,c,d,e){"string"!=typeof c&&(e=d,d=c);for(var f=_.listener(a),g=0,h=b.length;h>g;g++){var i=b[g],j={target:a,selector:c,fn:d,data:e};i=j.type=_.parse(i,j);var k=f.s[i];k||(k=f.s[i]=[],a.addEventListener&&a.addEventListener(i,f)),k.push(j)}},_.secret="Eventier"+Math.random(),_.listener=function(a){var b=a[_.secret];return b||(b=function(a){return _.handle(a,b.s[a.type])},b.s={},Object.defineProperty(a,_.secret,{value:b,configurable:!0})),b},_.handle=function(a,b){for(var c,d,e,f,g=0,h=b.length;h>g;g++)if(_.handles(a,c=b[g])&&(e=_.target(c,a.target))){f=[a],a.data&&f.push.apply(f,a.data),c.data&&f.unshift.apply(f,c.data);try{c.fn.apply(e,f)}catch(i){d||(d=i)}a.immediatePropagationStopped&&(g=h)}if(d)throw d;return!a.defaultPrevented},_.handles=function(a,b){return!(b.type&&a.type!==b.type||b.category&&a.category!==b.category||b.tags&&!_.subset(b.tags,a.tags))},_.subset=function(a,b){if(b&&b.length){for(var c=0,d=a.length;d>c;c++)if(b.indexOf(a[c])<0)return!1;return!0}},_.target=function(a,b){return a.selector?_.closest(b,a.selector):a.target},_.closest=function(a,b){for(;a&&a.matches;){if(a.matches(b))return a;a=a.parentNode}};var Ep=Element&&Element.prototype,aS="atchesSelector";Ep&&Object.defineProperty(Ep,"matches",Ep["webkitM"+aS]||Ep["mozM"+aS]||Ep["msM"+aS]),Eventier.on=_.fixArgs(4,_.on),_.off=function(a,b,c){if(!b)return _.wipe(a);for(var d=_.listener(a).s,e=0,f=b.length;f>e;e++){var g=b[e],h={fn:c,target:a};if(g=h.type=_.parse(g,h))_.filter(d[g],h);else{for(g in d)_.clean(d[g],h);_.empty(d)&&_.wipe(a)}}},_.empty=function(a){for(var b in a)return!b;return!0},_.wipe=function(a){delete a[_.secret]},_.clean=function(a,b){for(var c=0,d=a.length;d>c;c++)_.cleans(a[c],b)&&a.splice(c--,1);return!a.length&&b.target.removeEventListener?(b.target.removeEventListener(b.type,_.listener(b.target)),!0):void 0},_.cleans=function(a,b){return!(!_.handles(a,b)||b.detail&&a.detail!==b.detail||b.fn&&a.fn!==b.fn)},Eventier.off=_.fixArgs(3,_.off),_.version="0.1.0";var define=global.define||_.noop;if(define((global.exports||global).Eventier=Eventier),HTML._&&"false"!==HTML.getAttribute("data-eventier-html")&&(_.copyTo(HTML._.fn),_.target)){var target=_.target;_.target=function(){return HTML._.node(target.apply(this,arguments))}}}(this,document,(document||{}).documentElement);