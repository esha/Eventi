/*! Eventi - v0.6.0 - 2014-03-04
* https://github.com/nbubna/Eventi
* Copyright (c) 2014 ESHA Research; Licensed MIT */
!function(global,document){"use strict";function Eventi(){return _.create.apply(this,arguments)}global.CustomEvent||(global.CustomEvent=document?function(a,b){b=b||{};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,!!b.bubbles,!!b.cancelable,b.detail),c}:function(a,b){b=b||{},this.type=a,this.bubbles=!!b.bubbles,this.detail=b.detail,this.timestamp=Date.now()});var _={global:new Function("return this")(),noop:function(){},slice:function(a,b){return Array.prototype.slice.call(a,b)},copy:function(a,b,c){if(a)for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c])},async:global.setImmediate||function(a){return setTimeout(a,0)},resolveRE:/^([\w\$]+)?((\.[\w\$]+)|\[(\d+|'(\\'|[^'])+'|"(\\"|[^"])+")\])*$/,resolve:function(reference,context){return _.resolveRE.test(reference)?(context=context||global,eval("context"+("["!==reference.charAt(0)?"."+reference:reference))):void 0},create:function(a,b){var c={text:a+""};a=_.parse(c.text,c),_.copy(b,c),"bubbles"in c||(c.bubbles=!0);var d=new CustomEvent(a,c);for(var e in c)_.skip.indexOf(e)<0&&(d[_.prop(e)]=c[e]);return d},skip:"bubbles cancelable detail type".split(" "),prop:function(a){return a},parse:function(a,b){return _.properties.forEach(function(c){a=a.replace(c[0],function(){return c[1].apply(b,arguments)||""})}),a?b.type=a:a},properties:[[/^_/,function(){this.bubbles=!1}],[/^\!/,function(){this._protect=!0}],[/\((.*)\)/,function(a,b){try{this.detail=_.resolve(b)||JSON.parse(b)}catch(c){this.detail=b}}],[/#(\w+)/g,function(a,b){(this.tags||(this.tags=[])).push(b),this[b]=!0}],[/^(\w+):/,function(a,b){this.category=b}]],splitRE:/ (?![^\(\)]*\))+/g,wrap:function(a,b,c){c=c||1;var d=function(d){var e=_.slice(arguments);d&&"string"!=typeof d||(d=this&&this!==Eventi?this:_.global,e.unshift(d)),e[c]=e[c]?(e[c]+"").split(_.splitRE):[""],e.length>b&&(e[b]=e.slice(b),e=e.slice(0,b+1));var f,g=_[a];if("length"in d&&d!==_.global)for(var h=0,i=d.length;i>h;h++)f=g.apply(e[0]=d[h],e);else f=g.apply(d,e);return void 0===f?this:f};return d.index=c,d}};Eventi._=_,(Eventi.fy=function(a){for(var b in Eventi){var c=Eventi[b];"function"!=typeof c||c.utility||Object.defineProperty(a,b,{value:c,writable:!0,configurable:!0})}return a}).utility=!0,_.fire=function(a,b,c,d){return"object"!=typeof c||c instanceof Event||!("bubbles"in c||"detail"in c||"cancelable"in c)?(void 0!==c&&(d=d?d.unshift(c)&&d:[c]),c={data:d}):c.data=d,_.fireAll(a,b,c)},_.fireAll=function(a,b,c){for(var d,e=0;e<b.length;e++)d=_.create(b[e],c),_.dispatch(a,d);return d},_.dispatch=function(a,b,c){(a.dispatchEvent||a[_key]||_.noop).call(a,b),a.parentObject&&b.bubbles&&!b.propagationStopped&&_.dispatch(a.parentObject,b,!0),!c&&b._singleton&&_.singleton(a,b)},Eventi.fire=_.wrap("fire",3),_.on=function(a,b,c,d,e){"function"==typeof c&&(void 0!==d&&(e=e?e.unshift(d)&&e:[d]),d=c,c=null);for(var f=0,g=b.length;g>f;f++)_.handler(a,b[f],c,d,e)},_.handler=function(a,b,c,d,e){var f={target:a,selector:c,fn:d,data:e,text:b,match:{}};return _.parse(b,f.match),delete f.match.tags,a!==_&&Eventi.fire(_,"handler#new",f),f.fn!==_.noop&&_.handlers(f.target,f.match.type).push(f),f},_.handlers=function(a,b){var c=_.listener(a),d=c.s[b];return d||(d=c.s[b]=[],a.addEventListener&&a.addEventListener(b,c)),d};var _key=_._key="_eventi"+Date.now();if(_.listener=function(a){var b=a[_key];return b||(b=function(a){var c=b.s[a.type];c&&_.handle(a,c)},b.s={},Object.defineProperty(a,_key,{value:b,writeable:!1,configurable:!0})),b},_.handle=function(a,b){for(var c,d,e=0;e<b.length&&!(_.matches(a,(c=b[e]).match)&&(d=_.target(c,a.target))&&(_.execute(d,a,c),a.immediatePropagationStopped));e++);},_.execute=function(a,b,c){var d=[b];b.data&&d.push.apply(d,b.data),c.data&&d.push.apply(d,c.data);try{c.fn.apply(a,d)}catch(e){_.async(function(){throw e})}},_.unhandle=function(a){a.fn=_.noop},_.matches=function(a,b,c){for(var d in b)if(b[d]!==a[d]&&(c||"_"!==d.charAt(0)))return!1;if(c)for(d in a)if("_"===d.charAt(0)&&a[d]!==b[d])return!1;return!0},_.target=function(a,b){return a.selector?_.closest(b,a.selector):a.target},_.closest=function(a,b){for(;a&&a.matches;){if(a.matches(b))return a;a=a.parentNode}},global.Element){var Ep=Element.prototype,aS="atchesSelector";Object.defineProperty(Ep,"matches",{value:Ep["webkitM"+aS]||Ep["mozM"+aS]||Ep["msM"+aS]})}Eventi.on=_.wrap("on",4),_.version="0.6.0";var sP=Event&&Event.prototype.stopPropagation||_.noop,sIP=Event&&Event.prototype.stopImmediatePropagation||_.noop;CustomEvent.prototype.stopPropagation=function(){this.propagationStopped=!0,sP.call(this)},CustomEvent.prototype.stopImmediatePropagation=function(){this.immediatePropagationStopped=!0,sIP.call(this)};var define=global.define||_.noop;define((global.exports||global).Eventi=Eventi)}(this,this.document);