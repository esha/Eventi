/*! Eventi - v0.1.0 - 2014-01-12
* https://github.com/nbubna/Eventi
* Copyright (c) 2014 ESHA Research; Licensed MIT */
!function(global,document,HTML){"use strict";var Eventi=function(){return _.create.apply(this,arguments)},_={global:document||global,noop:function(){},slice:function(a,b){return Array.prototype.slice.call(a,b)},copy:function(a,b,c){for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c])},resolveRE:/^([\w\$]+)?((\.[\w\$]+)|\[(\d+|'(\\'|[^'])+'|"(\\"|[^"])+")\])*$/,resolve:function(reference,context){return _.resolveRE.test(reference)?(context=context||global,eval("context"+("["!==reference.charAt(0)?"."+reference:reference))):void 0},create:function(a,b){var c={};a=_.parse(a,c),_.copy(b,c),"bubbles"in c||(c.bubbles=!0);var d=new CustomEvent(a,c);for(var e in c)d[_.prop(e)]=c[e];return _.iPS(d),d},prop:function(a){return a},iPS:function(a){var b=a.stopImmediatePropagation||_.noop;a.stopImmediatePropagation=function(){b.call(this),a.immediatePropagationStopped=!0}},parse:function(a,b){return b.text=a,_.properties.forEach(function(c){a=a.replace(c[0],function(){return c[1].apply(b,arguments)||""})}),a},properties:[[/^_/,function(){this.bubbles=!1}],[/\((.*)\)/,function(a,b){try{this.detail=_.resolve(b)||JSON.parse(b)}catch(c){this.detail=b}}],[/#(\w+)/g,function(a,b){(this.tags||(this.tags=[])).push(b),this[b]=!0}],[/^(\w+):/,function(a,b){this.category=b}]],splitRE:/( |\+|>)(?![^\(\)]*\))+/g,wrap:function(a,b,c){return function(d){var e,f=_.slice(arguments);if("string"==typeof d&&(d=this&&this!==Eventi?this:_.global,f.unshift(d)),c=c||1,f[c]=f[c].split(_.splitRE),f.length>b&&(f[b]=f.slice(b),f=f.slice(0,b)),"length"in d)for(var g=0,h=d.length;h>g;g++)e=a.apply(d,f);else e=a.apply(d,f);return void 0===e?this:e}}};Eventi._=_,Eventi.fy=function(a,b,c){for(b in Eventi)"fy"===b||b in a||"function"!=typeof(c=Eventi[b])||(a[b]=c);return a},_.fire=function(a,b,c,d){return c?"object"==typeof c&&("bubbles"in c||"detail"in c||"cancelable"in c)||(d=d?d.unshift(c)&&d:[c]):c={},d&&d.length&&(c.data=d),_.trigger(a,b,c)},_.trigger=function(a,b,c){for(var d,e=0;e<b.length;e++)d=_.create(b[e],c),_.dispatch(a,d);return d},_.dispatch=function(a,b){(a.dispatchEvent||a[_.secret]||_.noop)(b)},Eventi.fire=_.wrap(_.fire,3),_.on=function(a,b,c,d,e){"string"!=typeof c&&(void 0!==d&&(e=e?e.unshift(d)&&e:[d]),d=c);for(var f=0,g=b.length;g>f;f++)_.handler(a,b[f],c,d,e)},_.handler=function(a,b,c,d,e){var f={target:a,selector:c,fn:d,data:e},g=_.listener(a),h=f.type=_.parse(b,f),i=g.s[h];return i||(i=g.s[h]=[],a.addEventListener&&a.addEventListener(h,g)),i.push(f),f},_._key="Eventi"+Math.random(),_.listener=function(a){var b=a[_._key];return b||(b=function(a){return _.handle(a,b.s[a.type])},b.s={},Object.defineProperty(a,_._key,{value:b,configurable:!0})),b},_.handle=function(a,b){for(var c,d,e=0,f=b.length;f>e;e++)_.handles(a,c=b[e])&&(d=_.target(c,a.target))&&(_.execute(d,a,c),a.immediatePropagationStopped&&(e=f));return!a.defaultPrevented},_.execute=function(a,b,c){var d=[b];b.data&&d.push.apply(d,b.data),c.data&&d.unshift.apply(d,c.data),c.before&&c.before();try{c.fn.apply(a,d)}catch(e){setTimeout(function(){throw e},0)}c.after&&c.after()},_.handles=function(a,b){return!(b.type&&a.type!==b.type||b.category&&a.category!==b.category||b.tags&&!_.subset(b.tags,a.tags))},_.subset=function(a,b){if(b&&b.length){for(var c=0,d=a.length;d>c;c++)if(b.indexOf(a[c])<0)return!1;return!0}},_.target=function(a,b){return a.selector?_.closest(b,a.selector):a.target},_.closest=function(a,b){for(;a&&a.matches;){if(a.matches(b))return a;a=a.parentNode}};var Ep=Element&&Element.prototype,aS="atchesSelector";Ep&&Object.defineProperty(Ep,"matches",Ep["webkitM"+aS]||Ep["mozM"+aS]||Ep["msM"+aS]),Eventi.on=_.wrap(_.on,4),_.off=function(a,b,c){if(!b)return _.wipe(a);for(var d=_.listener(a).s,e=0,f=b.length;f>e;e++){var g=b[e],h={fn:c,target:a};if(g=h.type=_.parse(g,h))_.filter(d[g],h);else{for(g in d)_.clean(d[g],h);_.empty(d)&&_.wipe(a)}}},_.empty=function(a){for(var b in a)return!b;return!0},_.wipe=function(a){delete a[_.secret]},_.clean=function(a,b){for(var c=0,d=a.length;d>c;c++)_.cleans(a[c],b)&&_.cleaned(a.splice(c--,1)[0]);return!a.length&&b.target.removeEventListener?(b.target.removeEventListener(b.type,_.listener(b.target)),!0):void 0},_.cleans=function(a,b){return!(!_.handles(a,b)||b.detail&&a.detail!==b.detail||b.fn&&a.fn!==b.fn)},_.cleaned=function(a){return a},Eventi.off=_.wrap(_.off,3),_.version="0.1.0";var define=global.define||_.noop;if(define((global.exports||global).Eventi=Eventi),global.CustomEvent||(global.CustomEvent=function(a,b){b=b||{};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,!!b.bubbles,!!b.cancelable,b.detail),c}),HTML._&&"false"!==HTML.getAttribute("data-eventier-html")&&(_.copyTo(HTML._.fn),_.target)){var target=_.target;_.target=function(){return HTML._.node(target.apply(this,arguments))}}}(this,document,(document||{}).documentElement);