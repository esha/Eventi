/*! Eventi - v0.1.0 - 2014-02-05
* https://github.com/nbubna/Eventi
* Copyright (c) 2014 ESHA Research; Licensed MIT */
!function(global,document){"use strict";function Eventi(){return _.create.apply(this,arguments)}var _={global:new Function("return this")(),noop:function(){},slice:function(a,b){return Array.prototype.slice.call(a,b)},copy:function(a,b,c){if(a)for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c])},resolveRE:/^([\w\$]+)?((\.[\w\$]+)|\[(\d+|'(\\'|[^'])+'|"(\\"|[^"])+")\])*$/,resolve:function(reference,context){return _.resolveRE.test(reference)?(context=context||global,eval("context"+("["!==reference.charAt(0)?"."+reference:reference))):void 0},create:function(a,b){var c={text:a+""};a=_.parse(c.text,c),_.copy(b,c),"bubbles"in c||(c.bubbles=!0);var d=new CustomEvent(a,c);for(var e in c)_.skip.indexOf(e)<0&&(d[_.prop(e)]=c[e]);return d.stopImmediatePropagation=_.sIP,d},skip:"bubbles cancelable detail type".split(" "),prop:function(a){return a},sIP:function(){this.immediatePropagationStopped=!0,(Event.prototype.stopImmediatePropagation||_.noop).call(this)},parse:function(a,b){return _.properties.forEach(function(c){a=a.replace(c[0],function(){return c[1].apply(b,arguments)||""})}),a?b.type=a:a},properties:[[/^_/,function(){this.bubbles=!1}],[/\((.*)\)/,function(a,b){try{this.detail=_.resolve(b)||JSON.parse(b)}catch(c){this.detail=b}}],[/#(\w+)/g,function(a,b){(this.tags||(this.tags=[])).push(b),this[b]=!0}],[/^(\w+):/,function(a,b){this.category=b}]],splitRE:/ (?![^\(\)]*\))+/g,wrap:function(a,b,c){c=c||1;var d=function(d){var e=_.slice(arguments);d&&"string"!=typeof d||(d=this&&this!==Eventi?this:_.global,e.unshift(d)),e[c]=e[c]?(e[c]+"").split(_.splitRE):[""],e.length>b&&(e[b]=e.slice(b),e=e.slice(0,b+1));var f,g=_[a];if("length"in d&&d!==_.global)for(var h=0,i=d.length;i>h;h++)f=g.apply(e[0]=d[h],e);else f=g.apply(d,e);return void 0===f?this:f};return d.index=c,d}};if(Eventi._=_,(Eventi.fy=function(a){for(var b in Eventi){var c=Eventi[b];"function"!=typeof c||c.utility||Object.defineProperty(a,b,{value:c,writable:!0,configurable:!0})}return a}).utility=!0,_.fire=function(a,b,c,d){return"object"!=typeof c||c instanceof Event||!("bubbles"in c||"detail"in c||"cancelable"in c)?(void 0!==c&&(d=d?d.unshift(c)&&d:[c]),c={data:d}):c.data=d,_.fireAll(a,b,c)},_.fireAll=function(a,b,c){for(var d,e=0;e<b.length;e++)d=_.create(b[e],c),_.dispatch(a,d);return d},_.dispatch=function(a,b){(a.dispatchEvent||a[_._key]||_.noop).call(a,b),a.parentObject&&_.dispatch(a.parentObject,b)},Eventi.fire=_.wrap("fire",3),_.on=function(a,b,c,d,e){"string"!=typeof c&&(void 0!==d&&(e=e?e.unshift(d)&&e:[d]),d=c,c=null);for(var f=0,g=b.length;g>f;f++)_.handler(a,b[f],c,d,e)},_.handler=function(a,b,c,d,e){var f={target:a,selector:c,fn:d,data:e,text:b,match:{}},g=_.listener(a),h=_.parse(b,f.match),i=g.s[h];return delete f.match.tags,i||(i=g.s[h]=[],a.addEventListener&&a.addEventListener(h,g)),i.push(f),f},_._key="Eventi"+Math.random(),_.listener=function(a){var b=a[_._key];return b||(b=function(a){_.handle(a,b.s[a.type]||[])},b.s={},Object.defineProperty(a,_._key,{value:b,writeable:!1,configurable:!0})),b},_.handle=function(a,b){for(var c,d,e=0,f=b.length;f>e;e++)_.matches(a,(c=b[e]).match)&&(d=_.target(c,a.target))&&(_.execute(d,a,c),a.immediatePropagationStopped&&(e=f))},_.execute=function(a,b,c){var d=[b];b.data&&d.push.apply(d,b.data),c.data&&d.push.apply(d,c.data);try{c.fn.apply(a,d)}catch(e){setTimeout(function(){throw e},0)}},_.matches=function(a,b){for(var c in b)if(b[c]!==a[c])return!1;return!0},_.target=function(a,b){return a.selector?_.closest(b,a.selector):a.target},_.closest=function(a,b){for(;a&&a.matches;){if(a.matches(b))return a;a=a.parentNode}},global.Element){var Ep=Element.prototype,aS="atchesSelector";Object.defineProperty(Ep,"matches",{value:Ep["webkitM"+aS]||Ep["mozM"+aS]||Ep["msM"+aS]})}Eventi.on=_.wrap("on",4),document&&(_.init=function(){for(var a=document.querySelectorAll("[data-eventi]"),b=0,c=a.length;c>b;b++){var d=a[b],e=d.getAttribute("data-eventi");e&&_.declare(e,d)}(a.length||document.querySelectorAll("[click]").length)&&Eventi.on("click keyup",_.check)},_.declare=function(a,b){for(var c=a.split(_.splitRE),d=0,e=c.length;e>d;d++){var f=c[d],g=f.lastIndexOf("="),h=g>0?f.substring(g+1):void 0,i="/"===f.charAt(0);h&&(f=f.substring(0,g)),i&&(f=f.substring(1),b=_.global),Eventi.on(b||_.global,f,_.declared,h)}},_.declared=function(a,b){var c=b||a.type,d=_.closest(a.target,"["+c+"]"),e=d&&d.getAttribute(c);e&&_.trigger(d,e,a)},_.trigger=function(a,b,c){var d=_.resolve(b,a)||_.resolve(b);"function"==typeof d?d.call(a,c):Eventi.fire(a,b,c)},_.check=function(a){("click"===a.type&&_.click(a.target)||13===a.keyCode&&_.enter(a.target))&&(_.declared(a,"click"),_.allowDefault(a)||a.preventDefault())},_.click=function(a){return a.getAttribute("click")||_.parentalClick(a)},_.enter=function(a){return"false"!==a.getAttribute("click")&&_.parentalClick(a,!0)},_.allowDefault=function(a){var b=a.target.type;return b&&("radio"===b||"checkbox"===b)},_.parentalClick=function(a,b){if(!a.isContentEditable){var c=a.nodeName.toLowerCase();if("textarea"!==c&&c!==(b?"button":"select")){var d=_.buttonRE.test(a.type);return b?!(d||"a"===c&&a.getAttribute("href")):d||"input"!==c}}},_.buttonRE=/^(submit|button|reset)$/,Eventi.on("DOMContentLoaded",_.init)),_.singletonRE=/^_?\^/,_.properties.splice(1,0,[_.singletonRE,function(){this.singleton=!0}]),_.singleton_dispatch=_.dispatch,_.dispatch=function(a,b){if(_.singleton_dispatch(a,b),b.singleton)do{var c=a[_._sKey];c?c.push(b):Object.defineProperty(a,_._sKey,{value:[b],configurable:!0})}while(a=a.parentNode)},_._sKey=_._key+"s.e.",_.singleton_handler=_.handler,_.handler=function(a,b,c,d){var e=_.singleton_handler.apply(this,arguments);if(e.singleton){e.after=function(){_.off&&_.off(a,b,d),e.fn=_.noop};var f=a[_._sKey];if(f)for(var g=0,h=f.length;h>g;g++){var i=f[g];if(_.handles(i,e)&&(a=_.target(e,i.target))){_.execute(a,i,e);break}}}return e},document&&Eventi.on("DOMContentLoaded",function(a){_.fire(document.documentElement,["^ready"],void 0,a)}),_.keyRE=/\[([a-z-0-9,\.\/\[\`\\\]\']+)\]/,_.properties.push([_.keyRE,function(a,b){for(var c,d;(c=b.indexOf("-"))>0;)d=b.substring(0,c),b=b.substring(c+1),this[(_.special[d]||d)+"Key"]=!0;this.keyCode=_.codes[b]||parseInt(b,10)||0}]),_.special={command:"meta",apple:"meta"},_.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,capsLock:20,escape:27,start:91,command:224,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,multiply:106,plus:107,minus:109,point:110,divide:111,numLock:144,",":188,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222,space:32};for(var n=0;10>n;n++)_.codes["num"+n]=96+n;for(var f=1;13>f;f++)_.codes["f"+f]=111+f;"abcdefghijklmnopqrstuvwxyz 0123456789".split("").forEach(function(a){_.codes[a]=a.toUpperCase().charCodeAt(0)}),_.off=function(a,b,c){var d=a[_._key];if(d){for(var e=0,f=b.length;f>e;e++){var g={fn:c},h=_.parse(b[e],g.match={});if(h)_.clean(h,g,d,a);else for(h in d.s)_.clean(h,g,d,a)}_.empty(d.s)&&delete a[_._key]}},_.empty=function(a){for(var b in a)return!b;return!0},_.clean=function(a,b,c,d){var e=c.s[a];if(e)for(var f=0,g=e.length;g>f;f++)_.cleans(e[f],b)&&(_.cleaned(e.splice(f--,1)[0]),g--);e.length||(d.removeEventListener&&d.removeEventListener(a,c),delete c.s[a])},_.cleans=function(a,b){return _.matches(a.match,b.match)&&(!b.fn||a.fn===b.fn)},_.cleaned=_.noop,Eventi.off=_.wrap("off",3),_.until=function(a,b,c,d,e,f){"string"!=typeof d&&(void 0!==e&&(f=f?f.unshift(e)&&f:[e]),e=d);for(var g=0,h=c.length;h>g;g++){var i=_.handler(a,c[g],d,e,f);_.untilAfter(i,b)}},_.untilAfter=function(a,b){var c=_.untilFn(a,b),d=a.fn;a.fn=function(){d.apply(this,arguments),c()&&(_.off&&_.off(a.target,a.text,d),a.fn=_.noop)}},_.untilFn=function(a,b){switch(typeof b){case"undefined":case"function":return b;case"number":return function(){return!--b};case"string":var c="!"===b.charAt(0);return c&&(b=b.substring(1)),function(){var d=_.resolve(b,a.target);return void 0===d&&(d=_.resolve(b)),c?!d:d}}},Eventi.until=_.wrap("until",5,2),_.comboRE=/\+|>/,_.combo_trigger=_.fireAll,_.fireAll=function(a,b,c,d){for(var e,f,g=0;g<b.length;g++){f=c.sequence=b[g].split(_.comboRE);for(var h=d||0;h<f.length&&(!e||!e.isSequencePaused());h++)f[h]?(c.index=h,e=c.previousEvent=_.create(f[h],c),_.sequence(e,c,a),_.dispatch(a,e)):f.splice(h--,1)}return e},_.sequence=function(a,b,c,d){a.resumeSequence=function(a){d&&(d=!1,_.fireAll(c,b.sequence,b,a||b.index))},a.pauseSequence=function(a){return d!==!1?(d=!0,a&&a.then(this.resumeSequence)):void 0},a.isSequencePaused=function(){return!!d}},_.combo_handler=_.handler,_.handler=function(a,b,c){var d=_.combo_handler.apply(this,arguments),e=b.match(_.comboRE);if(e){for(var f=b.split(e[0]),g=d.comboFn=_.comboFn(">"===e[0],f,b),h=0,i=f.length;i>h;h++)f[h]=_.handler(a,f[h],c,g).type;g.reset()}return d},_.comboTimeout=1e3,_.comboFn=function(a,b,c){var d,e,f=function(){e&&clearTimeout(e),d=b.slice()},g=function(b){e||(e=setTimeout(f,_.comboTimeout));var g=d.indexOf(b.type);(a?0===g:g>=0)&&(d.splice(g,1),d.length||(_.fire(b.target,c),f()))};return g.reset=f,g},_.off&&(_.combo_cleaned=_.cleaned,_.cleaned=function(a){_.combo_cleaned.apply(this,arguments),a.comboFn&&_.off(a.target,"",a.comboFn)}),_.signal=function(a){return _.signal[a]||(_.signal[a]=function(b){var c=_.slice(arguments),d=this.index||1;return("object"!=typeof b||!b.dispatchEvent&&!b[_._key])&&d--,c.splice(d,0,a),this.apply(null,c)})},_.bind=function(a,b){var c=function(){return b.apply(a,arguments)};return c.index=b.index,c},(Eventi.signal=function(a){var b=_.slice(arguments);"string"==typeof a&&(a=Eventi);for(var c in Eventi){var d=a[c];if("function"==typeof d&&!d.utility){a!==Eventi&&d===Eventi[c]&&(d=a[c]=_.bind(a,d));for(var e=0,f=b.length;f>e;e++){var g=b[e];d[g]=_.signal(g)}}}}).utility=!0,_.version="0.1.0";var define=global.define||_.noop;define((global.exports||global).Eventi=Eventi),global.CustomEvent||(global.CustomEvent=document?function(a,b){b=b||{};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,!!b.bubbles,!!b.cancelable,b.detail),c}:function(a,b){b=b||{},this.type=a,this.bubbles=!!b.bubbles,this.detail=b.detail,this.timestamp=Date.now()})}(this,this.document);